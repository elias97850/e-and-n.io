<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Our First Year</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    
    <!-- Fuentes para el Popup y la App -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet" />
    
    <!-- Carga principal de Iconos de Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <style>
        .font-serif-display {
            font-family: 'Playfair Display', serif;
        }

        .font-script {
            font-family: 'Dancing Script', cursive;
        }
        
        /* FIX: Asegurar que todos los 'material-symbols-outlined' usen la fuente correcta */
        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined';
        }

        /* Estilo para el nuevo 铆cono de flecha */
        .material-symbols-outlined.icon-arrow-back-style {
            font-variation-settings:
                'FILL' 1,
                'wght' 700,
                'GRAD' 0,
                'opsz' 48;
            font-size: 40px; /* M谩s grande para ser m谩s 'thick' */
        }
        
        /* Ocultar barra de scroll en main */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }

        .strawberry {
            position: absolute;
            top: -50px;
            /* Empezar fuera de la pantalla */
            font-size: 2rem;
            user-select: none;
            animation: fall linear;
            z-index: 50;
            opacity: 1;
            /* Siempre opacidad 100% */
        }

        @keyframes fall {
            from {
                transform: translateY(0vh) rotate(0deg);
            }

            to {
                transform: translateY(105vh) rotate(360deg);
                /* Caer hasta abajo */
            }
        }

        .strawberry-heart-piece {
            position: absolute;
            font-size: 2rem;
            transform-origin: center;
            z-index: 100;
            /* Iniciar invisible y centrado para la animaci贸n fadeIn */
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
            /* Corregido: centrar desde el inicio */
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
                /* Corregido: mantener el centrado */
            }
        }

        /* Estilo para el cursor 'grabbing' del modal */
        #heartModalContainer.grabbing {
            cursor: grabbing;
        }

        /* Animaciones del Modal del Coraz贸n 3D */
        .modal-hidden {
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 300ms ease-out, transform 300ms ease-out;
            pointer-events: none;
        }
        .modal-visible {
            opacity: 1;
            transform: scale(1);
            transition: opacity 300ms ease-in, transform 300ms ease-in;
        }
    </style>
    
    <script id="tailwind-config">
        tailwind.config = {
             darkMode: "class", // Habilitar dark mode si se usa
            theme: {
                extend: {
                    colors: {
                        // Colores del Popup
                        "primary-darker": "#9370DB",
                        "accent-gold": "#F0E68C",
                        "pastel-purple": "#D1C4E9",
                        "dark-purple": "#673AB7",
                        "text-light": "#333333",
                        "text-dark": "#F5F5F5",

                        // Colores de la App (unificados)
                        "primary": "#a65eed", // Tono violeta principal
                        "background-light": "#f7f6f8", // Fondo claro de la App
                        "background-dark": "#191121", // Fondo oscuro (si se usa)
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"],
                        "script": ["Dancing Script", "cursive"],
                        "serif-display": ['Playfair Display', 'serif']
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                    keyframes: {
                        // Keyframes del Popup
                        fadeIn: {
                            '0%': { opacity: 0, transform: 'translateY(10px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: 0, transform: 'translateY(20px) scale(0.95)' },
                            '100%': { opacity: 1, transform: 'translateY(0) scale(1)' },
                        },
                        backdropIn: {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 },
                        },
                        backgroundPulse: {
                            '0%, 100%': { filter: 'brightness(1) blur(6px)' },
                            '50%': { filter: 'brightness(1.1) blur(8px)' },
                        },
                        // AADIDO: Animaci贸n de salida para el popup
                        fadeOut: {
                            'from': { opacity: 1 },
                            'to': { opacity: 0 }
                        },
                    },
                    animation: {
                        // Animaciones del Popup
                        fadeIn: 'fadeIn 1s ease-out forwards',
                        fadeInUp: 'fadeInUp 0.5s ease-out forwards',
                        backdropIn: 'backdropIn 0.5s ease-out forwards',
                        backgroundPulse: 'backgroundPulse 12s ease-in-out infinite',
                        fadeOut: 'fadeOut 0.5s ease-out forwards', // AADIDO
                    },
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        /* Estilos del Popup (Tailwind) */
        :root {
            --popup-bg-color: #FFFFFF;
            --popup-text-color: #3C3C5C;
            --secondary-text-color: #6C6C8E;
            --highlight-color: #A78BFA;
            --button-bg-color: #8B5CF6;
            --button-hover-bg: #7C3AED;
            --button-text-color: #FFFFFF;
            --background-image: url('https://source.unsplash.com/random/800x1200/?romantic,abstract,memory,landscape');
        }
        .popup-box-bg {
            background-color: var(--popup-bg-color);
            color: var(--popup-text-color);
        }
        .popup-text-secondary {
            color: var(--secondary-text-color);
        }
        .popup-highlight {
            color: var(--highlight-color);
        }
    </style>
</head>

<body class="font-display bg-zinc-100 flex justify-center items-center p-0 sm:p-4 overflow-hidden"> 
    
    <!-- ===== POPUP INICIAL ===== -->
    <div class="group/design-root fixed inset-0 z-50 flex h-dvh w-full items-center justify-center p-6 animate-backdropIn" id="welcome-popup">
        <div class="absolute inset-0 bg-[var(--background-image)] bg-cover bg-center animate-backgroundPulse" style="background-image: url('https://images.unsplash.com/photo-1531685250784-75b9f106852e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wzNjc5fDB8MHxwaG90by1yZWxhdGVkfDE5fHx8ZW58MHx8fHx8&ixlib=rb-4.0.3&q=80&w=1080');"></div>
        <div class="absolute inset-0 bg-black/30 backdrop-blur-md"></div>
        <div class="relative w-full max-w-sm animate-fadeInUp rounded-xl popup-box-bg shadow-2xl shadow-purple-500/30">
            <div class="relative flex flex-col items-center justify-center p-8 text-center">
                <div class="mb-4">
                    <span class="material-symbols-outlined text-5xl popup-highlight">favorite</span>
                </div>
                <h1 class="font-script text-[var(--popup-text-color)] text-4xl font-bold tracking-tight leading-tight">
                    A Year of Our Beautiful Journey
                </h1>
                <p class="popup-text-secondary mt-2 text-base">To my dearest Nurialys Castillo Alers</p>
                <p class="mt-2 text-lg font-bold text-[#8B5CF6]">
                    <span>November 23 2025</span>
                </p>
                <!-- Bot贸n para cerrar el popup -->
                <button id="closePopup" class="mt-8 flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-full h-14 px-5 bg-[var(--button-bg-color)] text-[var(--button-text-color)] text-xl font-bold tracking-[0.015em] shadow-lg shadow-purple-500/30 transition-all duration-200 ease-in-out active:scale-95 hover:bg-[var(--button-hover-bg)]">
                    <span class="truncate font-bold">TE AMO</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ===== APLICACIN PRINCIPAL (Oculta al inicio) ===== -->
    <div id="main-content-wrapper" class="relative flex h-dvh w-full max-w-md flex-col bg-background-light group/design-root overflow-x-hidden sm:shadow-2xl sm:rounded-2xl" style="display: none;">
        
        <div class="flex items-center bg-transparent p-4 pb-2 justify-between text-zinc-900">
            <div class="flex w-12 shrink-0 items-center justify-start">
                <!-- Bot贸n para ABRIR el modal del coraz贸n 3D -->
                <button id="heartButton" class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-12 w-12 bg-transparent gap-2 text-base font-bold leading-normal tracking-[0.015em] min-w-0 p-0 hover:bg-primary/10 transition-colors">
                    <span class="text-2xl">わ</span>
                </button>
            </div>
            <h2 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">One Thousand More</h2>
            <div class="flex w-12 items-center justify-end">
                <!-- Bot贸n de Fresa -->
                <button id="strawberryButton" class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-12 w-12 bg-transparent gap-2 text-base font-bold leading-normal tracking-[0.015em] min-w-0 p-0 hover:bg-primary/10 transition-colors">
                    <span class="text-2xl"></span>
                </button>
            </div>
        </div>

        <!-- Contenedor principal de la lista (scrollable) -->
        <main class="flex flex-1 flex-col overflow-y-auto px-4 pb-4 scrollbar-hide">
            
            <!-- Countdown (movido dentro del <main>) -->
            <div class="relative mb-6 mt-4 rounded-xl border-4 border-primary/50 bg-white p-3 shadow-lg flex flex-col items-center justify-center text-center text-zinc-900">
                <div class="absolute inset-0 scale-105 bg-primary/20 rounded-xl blur-2xl opacity-60"></div>
                <div class="relative z-10 w-full flex flex-col items-center justify-center">
                    <p class="text-sm font-medium text-primary mb-1">Our next anniversary</p>
                    <div class="flex items-baseline justify-center gap-x-1.5 text-zinc-900 flex-wrap px-2">
                        <!-- IDs para el countdown -->
                        <span id="countdown-days" class="text-2xl font-bold tracking-tighter">0</span><span class="text-sm font-medium text-zinc-500">d</span>
                        <span id="countdown-hours" class="text-2xl font-bold tracking-tighter">0</span><span class="text-sm font-medium text-zinc-500">h</span>
                        <span id="countdown-minutes" class="text-2xl font-bold tracking-tighter">0</span><span class="text-sm font-medium text-zinc-500">m</span>
                        <span id="countdown-seconds" class="text-2xl font-bold tracking-tighter">0</span><span class="text-sm font-medium text-zinc-500">s</span>
                    </div>
                    <div class="mt-3 w-full bg-primary/10 rounded-md py-2 px-4 text-sm text-zinc-700">
                        <p>Celebrating every precious moment.</p>
                    </div>
                </div>
            </div>

            <!-- Lista de tarjetas -->
            <div class="grid grid-cols-1 gap-6 py-4">

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">calendar_today</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Nov 23, 2023</p>
                        <h3 class="font-semibold text-zinc-900">Our First Anniversary!</h3>
                        <p class="text-sm text-zinc-700 mt-2">A sweet day marking the beginning of our journey. Remember the cake and the laughter!</p>
                    </div>
                </div>

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">emoji_events</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Oct 15, 2023</p>
                        <h3 class="font-semibold text-zinc-900">Weekend Getaway</h3>
                        <p class="text-sm text-zinc-700 mt-2">Explored new places and made unforgettable memories. The sunrise hike was amazing!</p>
                    </div>
                </div>

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">favorite</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Aug 01, 2023</p>
                        <h3 class="font-semibold text-zinc-900">First Home-cooked Dinner</h3>
                        <p class="text-sm text-zinc-700 mt-2">Enjoyed a cozy evening with our favorite dishes. Your lasagna was incredible!</p>
                    </div>
                </div>

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">redeem</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Jun 20, 2023</p>
                        <h3 class="font-semibold text-zinc-900">Surprise Gift</h3>
                        <p class="text-sm text-zinc-700 mt-2">Received the most thoughtful present! I still cherish it every day.</p>
                    </div>
                </div>

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">park</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Apr 10, 2023</p>
                        <h3 class="font-semibold text-zinc-900">Spring Picnic</h3>
                        <p class="text-sm text-zinc-700 mt-2">A perfect day at the park, full of laughter and sunshine. Remember the frisbee?</p>
                    </div>
                </div>

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">celebration</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Feb 14, 2023</p>
                        <h3 class="font-semibold text-zinc-900">Valentine's Day Date</h3>
                        <p class="text-sm text-zinc-700 mt-2">Romantic dinner and sweet conversations. The best Valentine's ever!</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Contenedores de Animaciones -->
        <div id="rain-container" class="absolute inset-0 pointer-events-none overflow-hidden"></div>
        <div id="heart-container" class="absolute inset-0 flex items-center justify-center pointer-events-none"></div>

    </div>

    <!-- ===== MODAL DEL CORAZN 3D ===== -->
    <!-- Fondo del Modal (con animaci贸n) -->
    <div id="heartModalBackdrop" class="fixed inset-0 bg-zinc-100 flex justify-center items-center p-0 sm:p-4 modal-hidden" style="z-index: 100; overflow: hidden;">
        
        <!-- Contenedor del Modal (layout de app) -->
        <div id="heartModalContainer" class="relative flex h-dvh w-full max-w-md flex-col bg-background-light group/design-root overflow-x-hidden sm:shadow-2xl sm:rounded-2xl" style="cursor: grab;">
            
            <!-- Bot贸n de cerrar movido a la izquierda con 铆cono -->
            <button id="closeHeartModal" class="absolute top-4 left-4 text-primary" style="z-index: 101; -webkit-user-select: none; user-select: none; opacity: 0.7; padding: 0.75rem; /* rea de toque aumentada */">
                 <span class="material-symbols-outlined icon-arrow-back-style">arrow_back_2</span>
            </button>
            
            <!-- Contenedor del Coraz贸n 3D -->
            <div class="flex-1 grid place-items-center overflow-hidden">
                <pre id="heart-display" style="font-family: 'Courier New', Courier, monospace; font-size: 12px; font-weight: 900; line-height: 1.0; text-align: center; color: #a65eed; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;"></pre>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // === LGICA DEL POPUP INICIAL ===
            const popup = document.getElementById('welcome-popup');
            const closePopupButton = document.getElementById('closePopup');
            const mainContent = document.getElementById('main-content-wrapper');

            if (popup && closePopupButton && mainContent) {
                closePopupButton.addEventListener('click', () => {
                    // Ocultar el popup con la animaci贸n de fade-out
                    popup.classList.remove('animate-backdropIn'); // Quitar animaci贸n de entrada
                    popup.classList.add('animate-fadeOut'); // A帽adir animaci贸n de salida
                    
                    setTimeout(() => {
                        popup.style.display = 'none';
                        // Mostrar el contenido principal
                        mainContent.style.display = 'flex';
                    }, 500); // Sincronizar con la transici贸n
                });
            } else {
                console.error("No se encontraron los elementos del popup o del contenido principal.");
                // Si algo falla, ocultar el popup y mostrar la app para que no se bloquee
                if (popup) popup.style.display = 'none';
                if (mainContent) mainContent.style.display = 'flex';
            }

            // === LGICA DEL COUNTDOWN ===
            const targetDate = new Date("2026-11-25T00:00:00").getTime();
            const daysEl = document.getElementById('countdown-days');
            const hoursEl = document.getElementById('countdown-hours');
            const minutesEl = document.getElementById('countdown-minutes');
            const secondsEl = document.getElementById('countdown-seconds');

            function updateCountdown() {
                if (!daysEl || !hoursEl || !minutesEl || !secondsEl) return;

                const now = new Date().getTime();
                const distance = targetDate - now;

                if (distance < 0) {
                    daysEl.innerText = "0";
                    hoursEl.innerText = "0";
                    minutesEl.innerText = "0";
                    secondsEl.innerText = "0";
                    clearInterval(countdownInterval);
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                daysEl.innerText = days;
                hoursEl.innerText = hours;
                minutesEl.innerText = minutes;
                secondsEl.innerText = seconds;
            }
            // Actualizar inmediatamente y luego cada segundo
            updateCountdown();
            const countdownInterval = setInterval(updateCountdown, 1000);


            // === LGICA DEL CORAZN DE FRESAS ===
            const strawberryButton = document.getElementById('strawberryButton');
            const rainContainer = document.getElementById('rain-container');
            const heartContainer = document.getElementById('heart-container');

            let consecutiveClicks = 0;
            let clickTimer = null;

            const animationStyleSheetEl = document.createElement('style');
            animationStyleSheetEl.type = 'text/css';
            document.head.appendChild(animationStyleSheetEl);
            const styleSheet = animationStyleSheetEl.sheet;

            if (strawberryButton && rainContainer && heartContainer) {
                strawberryButton.addEventListener('click', () => {
                    consecutiveClicks++;
                    if (clickTimer) clearTimeout(clickTimer);

                    if (consecutiveClicks === 10) {
                        heartContainer.innerHTML = '';
                        createStrawberryHeart();
                        consecutiveClicks = 0;
                    } else {
                        for (let i = 0; i < 15; i++) {
                            createFallingStrawberry();
                        }
                    }

                    clickTimer = setTimeout(() => {
                        consecutiveClicks = 0;
                    }, 2000);
                });
            }

            function createFallingStrawberry() {
                const strawberry = document.createElement('div');
                strawberry.classList.add('strawberry');
                strawberry.innerText = '';

                strawberry.style.left = `${Math.random() * 100}%`;
                const duration = Math.random() * 2 + 1;
                strawberry.style.animationDuration = `${duration}s`;
                strawberry.style.animationDelay = `${Math.random() * 1}s`;
                strawberry.style.fontSize = `${Math.random() * 1.5 + 1}rem`;
                strawberry.style.opacity = `1`;

                rainContainer.appendChild(strawberry);

                setTimeout(() => {
                    strawberry.remove();
                }, (duration + 1) * 1000);
            }

            function createStrawberryHeart() {
                const heartPattern = [
                    "    ****** ******",
                    "    ****** ******",
                    "  ********** **********",
                    "  ********** **********",
                    " ************* *************",
                    "*****************************",
                    "*****************************",
                    "*****************************",
                    "*****************************",
                    " ***************************",
                    " ***************************",
                    "   ***********************",
                    "   ***********************",
                    "     *******************",
                    "     *******************",
                    "       ***************",
                    "       ***************",
                    "         ***********",
                    "         ***********",
                    "           *******",
                    "           *******",
                    "             ***",
                    "             ***",
                    "              *"
                ];

                const scale = 13; // Hecho m谩s compacto
                const strawberrySize = 1.5;
                const delayBetweenFresas = 10; // Dibujar r谩pido

                const maxWidth = heartPattern.reduce((max, r) => Math.max(max, r.length), 0);
                const totalStars = heartPattern.join('').replace(/ /g, '').length;
                let starsPlaced = 0;

                heartPattern.forEach((row, rowIndex) => {
                    for (let i = 0; i < row.length; i++) {
                        if (row[i] === '*') {
                            setTimeout(() => {
                                const strawberry = document.createElement('div');
                                strawberry.classList.add('strawberry-heart-piece');
                                strawberry.innerText = '';

                                const xOffset = (i - (maxWidth - 1) / 2) * scale;
                                const yOffset = (rowIndex - (heartPattern.length - 1) / 2) * scale;

                                strawberry.style.left = `calc(50% + ${xOffset}px)`;
                                strawberry.style.top = `calc(50% + ${yOffset}px)`;
                                strawberry.style.fontSize = `${strawberrySize}rem`;
                                heartContainer.appendChild(strawberry);

                                starsPlaced++;

                                if (starsPlaced === totalStars) {
                                    // Esperar 750ms despu茅s de DIBUJAR la 煤ltima fresa
                                    setTimeout(explodeHeart, 750); 
                                }
                            }, starsPlaced * delayBetweenFresas); // Usar el contador para el retraso
                        }
                    }
                });
            }

            function explodeHeart() {
                const strawberries = heartContainer.querySelectorAll('.strawberry-heart-piece');
                strawberries.forEach((strawberry, index) => {
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * 200 + 100;
                    const translateX = distance * Math.cos(angle);
                    const translateY = distance * Math.sin(angle);
                    const rotation = Math.random() * 720 - 360;

                    const keyframesName = `explode-strawberry-${index}`;

                    try {
                        styleSheet.insertRule(`
                            @keyframes ${keyframesName} {
                                from {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                    filter: blur(0);
                                }
                                to {
                                    transform: translate(calc(-50% + ${translateX}px), calc(-50% + ${translateY}px)) rotate(${rotation}deg) scale(1);
                                    opacity: 0;
                                    filter: blur(2px);
                                }
                            }
                        `, styleSheet.cssRules.length);

                        strawberry.style.animation = `${keyframesName} 1.5s ease-out forwards`;
                    } catch (e) {
                        console.warn("Error insertando regla CSS (ignorable si son pocas):", e.message);
                        strawberry.remove(); // Limpiar si falla la animaci贸n
                    }


                    setTimeout(() => {
                        strawberry.remove();
                        // Limpiar la regla de keyframes
                        try {
                            for (let i = 0; i < styleSheet.cssRules.length; i++) {
                                if (styleSheet.cssRules[i] && styleSheet.cssRules[i].name === keyframesName) {
                                    styleSheet.deleteRule(i);
                                    break;
                                }
                            }
                        } catch (e) {
                           // Ignorar errores al limpiar (puede pasar si la hoja de estilos est谩 ocupada)
                        }
                    }, 1500);
                });
            }

            // === LGICA DEL CORAZN 3D ===

            // --- Referencias a elementos del Modal ---
            const heartButton = document.getElementById('heartButton');
            const heartModalBackdrop = document.getElementById('heartModalBackdrop');
            const closeHeartModal = document.getElementById('closeHeartModal');
            const heartDisplayPre = document.getElementById('heart-display');
            const heartModalContainer = document.getElementById('heartModalContainer'); 

            if (heartButton && heartModalBackdrop && closeHeartModal && heartDisplayPre && heartModalContainer) {

                // --- Constantes y variables globales del Coraz贸n 3D ---
                const PI = Math.PI;
                const LUMINANCE = ".,-~:;=!*#$@"; // 12 caracteres

                let SCREEN_WIDTH, SCREEN_HEIGHT;
                let output, zbuffer;

                let heart_angleA = 0; // ngulo de rotaci贸n X
                let heart_angleB = 0; // ngulo de rotaci贸n Y

                let heart_animationId = null; // Para iniciar/detener el loop

                // --- Variables para control de mouse/touch ---
                let heart_isDragging = false;
                let heart_lastMouseX = 0;
                let heart_lastMouseY = 0;

                // --- Funciones de Math ---
                const cos = Math.cos;
                const sin = Math.sin;
                const sqrt = Math.sqrt;

                /**
                 * Inicializa (o reinicializa) los buffers con el tama帽o del modal.
                 */
                function setupBuffers() {
                    const charWidth = 8; // Ancho (Courier 12px 900)
                    const charHeight = 12; // Alto (font-size 12px)

                    SCREEN_WIDTH = Math.floor(heartModalContainer.clientWidth / charWidth); 
                    SCREEN_HEIGHT = Math.floor(heartModalContainer.clientHeight / charHeight); 
                    
                    if (SCREEN_WIDTH <= 0 || SCREEN_HEIGHT <= 0) {
                        SCREEN_WIDTH = 80; // Default
                        SCREEN_HEIGHT = 40; // Default
                    }

                    output = Array(SCREEN_HEIGHT).fill(0).map(() => Array(SCREEN_WIDTH).fill(' '));
                    zbuffer = Array(SCREEN_HEIGHT).fill(0).map(() => Array(SCREEN_WIDTH).fill(-Infinity));
                }

                /**
                 * Renderiza un frame del coraz贸n 3D.
                 */
                function renderFrame(A, B) {
                    const cosA = cos(A), sinA = sin(A);
                    const cosB = cos(B), sinB = sin(B);

                    for (let i = 0; i < SCREEN_HEIGHT; i++) {
                        for (let j = 0; j < SCREEN_WIDTH; j++) {
                            output[i][j] = ' ';
                            zbuffer[i][j] = -Infinity;
                        }
                    }

                    for (let u = 0; u < 2 * PI; u += 0.04) { 
                        for (let v = 0; v < PI; v += 0.04) { 

                            // Ecuaciones param茅tricas (versi贸n original/peque帽a)
                            let x = sin(v) * (15 * sin(u) - 4 * sin(3 * u));
                            let y = 8 * cos(v);
                            let z = sin(v) * (15 * cos(u) - 5 * cos(2 * u) - 2 * cos(3 * u) - cos(4 * u));

                            let x1 = x * cosB + z * sinB;
                            let y1 = y;
                            let z1 = -x * sinB + z * cosB;

                            let x_rot = x1;
                            let y_rot = y1 * cosA - z1 * sinA;
                            let z_rot = y1 * sinA + z1 * cosA;

                            // Proyecci贸n
                            let z_offset = 40; // Zoom in (reducido de 70 -> 50 -> 40)
                            let ooz = 1 / (z_rot + z_offset); 
                            
                            let xp = Math.floor(SCREEN_WIDTH / 2 + x_rot * ooz * SCREEN_WIDTH * 0.5);
                            let yp = Math.floor(SCREEN_HEIGHT / 2 - y_rot * ooz * SCREEN_HEIGHT * 0.5);

                            // Normales
                            let nx = sin(v) * (15 * cos(u) - 4 * cos(3 * u));
                            let ny = 8 * -sin(v) * sin(v);
                            let nz = cos(v) * (15 * sin(u) - 5 * sin(2 * u) - 2 * sin(3 * u) - sin(4 * u));

                            let nx1 = nx * cosB + nz * sinB;
                            let ny1 = ny;
                            let nz1 = -nx * sinB + nz * cosB;

                            let nx_rot = nx1;
                            let ny_rot = ny1 * cosA - nz1 * sinA;
                            let nz_rot = ny1 * sinA + nz1 * cosA;

                            let length = sqrt(nx_rot * nx_rot + ny_rot * ny_rot + nz_rot * nz_rot);
                            nx_rot /= length;
                            ny_rot /= length;
                            nz_rot /= length;

                            let lx = 0;
                            let ly = 0;
                            let lz = -1; 

                            let L = nx_rot * lx + ny_rot * ly + nz_rot * lz;
                            
                            let luminance_index = Math.floor((L + 1) * 5.5);

                            if (xp >= 0 && xp < SCREEN_WIDTH && yp >= 0 && yp < SCREEN_HEIGHT) {
                                if (ooz > zbuffer[yp][xp]) {
                                    zbuffer[yp][xp] = ooz;
                                    luminance_index = luminance_index < 0 ? 0 : (luminance_index > 11 ? 11 : luminance_index);
                                    output[yp][xp] = LUMINANCE[luminance_index];
                                }
                            }
                        }
                    }
                }

                /**
                 * Bucle de animaci贸n del coraz贸n
                 */
                function heartLoop() {
                    if (!heart_isDragging) {
                        heart_angleA += 0.02; // M谩s lento
                        heart_angleB += 0.0075; // M谩s lento
                    }

                    renderFrame(heart_angleA, heart_angleB);

                    let outputString = "";
                    for (let i = 0; i < SCREEN_HEIGHT; i++) {
                        outputString += output[i].join('');
                        outputString += '\n';
                    }
                    heartDisplayPre.textContent = outputString;

                    heart_animationId = requestAnimationFrame(heartLoop);
                }

                // --- Event Listeners para Abrir/Cerrar Modal ---

                function openModal() {
                    heartModalBackdrop.classList.remove('modal-hidden');
                    heartModalBackdrop.classList.add('modal-visible');
                    document.body.style.overflow = 'hidden'; 
                    setupBuffers(); 
                    if (heart_animationId) cancelAnimationFrame(heart_animationId); 
                    heartLoop(); 
                }

                function closeModal() {
                    heartModalBackdrop.classList.remove('modal-visible');
                    heartModalBackdrop.classList.add('modal-hidden');
                    document.body.style.overflow = ''; 
                    if (heart_animationId) {
                        cancelAnimationFrame(heart_animationId); 
                        heart_animationId = null;
                    }
                }

                // Abrir el modal
                heartButton.addEventListener('click', openModal);

                // Cerrar el modal (con click y touch)
                closeHeartModal.addEventListener('click', closeModal);
                closeHeartModal.addEventListener('touchstart', (e) => {
                    e.preventDefault(); // Evitar "click" fantasma
                    closeModal();
                }, { passive: false });


                // --- Listeners de Mouse (Rotaci贸n) ---
                heartModalContainer.addEventListener('mousedown', (e) => { 
                    if (e.target === closeHeartModal || closeHeartModal.contains(e.target)) return; // No arrastrar si se hace clic en el bot贸n
                    heart_isDragging = true;
                    heart_lastMouseX = e.clientX;
                    heart_lastMouseY = e.clientY;
                    heartModalContainer.classList.add('grabbing'); 
                    e.preventDefault(); 
                });

                heartModalContainer.addEventListener('mousemove', (e) => { 
                    if (!heart_isDragging) return;
                    const deltaX = e.clientX - heart_lastMouseX;
                    const deltaY = e.clientY - heart_lastMouseY;
                    heart_angleB += deltaX * 0.005;
                    heart_angleA -= deltaY * 0.005; 
                    heart_lastMouseX = e.clientX;
                    heart_lastMouseY = e.clientY;
                });

                heartModalContainer.addEventListener('mouseup', () => { 
                    heart_isDragging = false;
                    heartModalContainer.classList.remove('grabbing'); 
                });

                heartModalContainer.addEventListener('mouseleave', (e) => { 
                    heart_isDragging = false;
                    heartModalContainer.classList.remove('grabbing'); 
                });

                // --- Listeners TCTILES (Rotaci贸n) ---
                heartModalContainer.addEventListener('touchstart', (e) => {
                    if (e.target === closeHeartModal || closeHeartModal.contains(e.target)) return; // No arrastrar si se toca el bot贸n
                    if (e.touches.length === 1) {
                        heart_isDragging = true;
                        heart_lastMouseX = e.touches[0].clientX;
                        heart_lastMouseY = e.touches[0].clientY;
                        heartModalContainer.classList.add('grabbing');
                        e.preventDefault();
                    }
                }, { passive: false });

                heartModalContainer.addEventListener('touchmove', (e) => {
                    if (!heart_isDragging || e.touches.length !== 1) return;
                    const deltaX = e.touches[0].clientX - heart_lastMouseX;
                    const deltaY = e.touches[0].clientY - heart_lastMouseY;
                    heart_angleB += deltaX * 0.005;
                    heart_angleA -= deltaY * 0.005;
                    heart_lastMouseX = e.touches[0].clientX;
                    heart_lastMouseY = e.touches[0].clientY;
                    e.preventDefault();
                }, { passive: false });

                heartModalContainer.addEventListener('touchend', () => {
                    heart_isDragging = false;
                    heartModalContainer.classList.remove('grabbing');
                });


                // Listener para redimensionar
                window.addEventListener('resize', () => {
                    if (heartModalBackdrop.classList.contains('modal-visible')) { 
                        setupBuffers();
                    }
                });

            } else {
                console.error("No se pudieron encontrar los elementos del modal del coraz贸n 3D.");
            }

        });
    </script>

</body>
</html>

