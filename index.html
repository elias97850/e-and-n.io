<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Our First Year</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            // darkMode: "class", // Eliminado para forzar light mode
            theme: {
                extend: {
                    colors: {
                        "primary": "#a65eed",
                        "background-light": "#f7f6f8",
                        "background-dark": "#191121",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "Noto Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: max(884px, 100dvh);
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>

    <style>
        .strawberry {
            position: absolute;
            top: -50px;
            /* Empezar fuera de la pantalla */
            font-size: 2rem;
            user-select: none;
            animation: fall linear;
            z-index: 50;
            opacity: 1;
            /* Siempre opacidad 100% */
        }

        @keyframes fall {
            from {
                transform: translateY(0vh) rotate(0deg);
            }

            to {
                transform: translateY(105vh) rotate(360deg);
                /* Caer hasta abajo */
            }
        }

        .strawberry-heart-piece {
            position: absolute;
            font-size: 2rem;
            transform-origin: center;
            z-index: 100;
            /* Iniciar invisible y centrado para la animaci贸n fadeIn */
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
            /* Corregido: centrar desde el inicio */
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
                /* Corregido: mantener el centrado */
            }
        }

        /* Estilo para el cursor 'grabbing' del modal */
        #heartModalContainer.grabbing {
            cursor: grabbing;
        }
    </style>
</head>

<body class="font-display bg-zinc-100 flex justify-center items-center p-0 sm:p-4">
    <div class="relative flex h-dvh min-h-screen w-full max-w-md flex-col bg-background-light group/design-root overflow-x-hidden sm:shadow-2xl sm:rounded-2xl">
        <div class="flex items-center bg-transparent p-4 pb-2 justify-between text-zinc-900">
            <div class="flex w-12 shrink-0 items-center justify-start">
                <!-- BOTN DEL CORAZN 3D (ID AADIDO) -->
                <button id="heartButton" class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-12 w-12 bg-transparent gap-2 text-base font-bold leading-normal tracking-[0.015em] min-w-0 p-0 hover:bg-primary/10 transition-colors">
                    <span class="text-2xl">わ</span>
                </button>
            </div>
            <h2 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">One Thousand More</h2>
            <div class="flex w-12 items-center justify-end">
                <!-- BOTN DE FRESA (ID EXISTENTE) -->
                <button id="strawberryButton" class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-12 w-12 bg-transparent gap-2 text-base font-bold leading-normal tracking-[0.015em] min-w-0 p-0 hover:bg-primary/10 transition-colors">
                    <span class="text-2xl"></span>
                </button>
            </div>
        </div>
        <div class="relative mb-6 mx-4 rounded-xl border-4 border-primary/50 bg-white p-3 shadow-lg flex flex-col items-center justify-center text-center text-zinc-900">
            <div class="absolute inset-0 scale-105 bg-primary/20 rounded-xl blur-2xl opacity-60"></div>
            <div class="relative z-10 w-full flex flex-col items-center justify-center">
                <p class="text-sm font-medium text-primary mb-1">Our next anniversary</p>
                <div class="flex items-baseline justify-center gap-x-1.5 text-zinc-900 flex-wrap px-2">
                    <span class="text-2xl font-bold tracking-tighter">245</span><span class="text-sm font-medium text-zinc-500">d</span>
                    <span class="text-2xl font-bold tracking-tighter">10</span><span class="text-sm font-medium text-zinc-500">h</span>
                    <span class="text-2xl font-bold tracking-tighter">32</span><span class="text-sm font-medium text-zinc-500">m</span>
                    <span class="text-2xl font-bold tracking-tighter">18</span><span class="text-sm font-medium text-zinc-500">s</span>
                </div>
                <div class="mt-3 w-full bg-primary/10 rounded-md py-2 px-4 text-sm text-zinc-700">
                    <p>Celebrating every precious moment.</p>
                </div>
            </div>
        </div>
        <main class="flex flex-1 flex-col overflow-y-auto px-4 pb-4 scrollbar-hide">
            <div class="grid grid-cols-1 gap-6 py-4">

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">calendar_today</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Nov 23, 2023</p>
                        <h3 class="font-semibold text-zinc-900">Our First Anniversary!</h3>
                        <p class="text-sm text-zinc-700 mt-2">A sweet day marking the beginning of our journey. Remember the cake and the laughter!</p>
                    </div>
                </div>

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">emoji_events</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Oct 15, 2023</p>
                        <h3 class="font-semibold text-zinc-900">Weekend Getaway</h3>
                        <p class="text-sm text-zinc-700 mt-2">Explored new places and made unforgettable memories. The sunrise hike was amazing!</p>
                    </div>
                </div>

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">favorite</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Aug 01, 2023</p>
                        <h3 class="font-semibold text-zinc-900">First Home-cooked Dinner</h3>
                        <p class="text-sm text-zinc-700 mt-2">Enjoyed a cozy evening with our favorite dishes. Your lasagna was incredible!</p>
                    </div>
                </div>

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">redeem</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Jun 20, 2023</p>
                        <h3 class="font-semibold text-zinc-900">Surprise Gift</h3>
                        <p class="text-sm text-zinc-700 mt-2">Received the most thoughtful present! I still cherish it every day.</p>
                    </div>
                </div>

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">park</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Apr 10, 2023</p>
                        <h3 class="font-semibold text-zinc-900">Spring Picnic</h3>
                        <p class="text-sm text-zinc-700 mt-2">A perfect day at the park, full of laughter and sunshine. Remember the frisbee?</p>
                    </div>
                </div>

                <div class="w-full bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="w-full h-32 bg-zinc-200 flex items-center justify-center text-zinc-500">
                        <span class="material-symbols-outlined text-4xl">celebration</span>
                    </div>
                    <div class="p-4">
                        <p class="text-xs text-zinc-500 mb-1">Feb 14, 2023</p>
                        <h3 class="font-semibold text-zinc-900">Valentine's Day Date</h3>
                        <p class="text-sm text-zinc-700 mt-2">Romantic dinner and sweet conversations. The best Valentine's ever!</p>
                    </div>
                </div>
            </div>
        </main>


        <div id="rain-container" class="absolute inset-0 pointer-events-none overflow-hidden"></div>
        <div id="heart-container" class="absolute inset-0 flex items-center justify-center pointer-events-none"></div>

    </div>

    <!-- MODAL DEL CORAZN 3D (MODIFICADO) -->
    <div id="heartModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex justify-center items-center p-0 sm:p-4" style="display: none; z-index: 100; overflow: hidden;">
        
        <!-- Contenedor con apariencia de celular (FONDO CAMBIADO) -->
        <div id="heartModalContainer" class="relative flex h-dvh min-h-screen w-full max-w-md flex-col bg-background-light group/design-root overflow-hidden sm:shadow-2xl sm:rounded-2xl" style="cursor: grab;">
            
            <!-- Bot贸n de cerrar (ajustado al nuevo contenedor y fondo) -->
            <button id="closeHeartModal" class="absolute top-4 right-4 text-zinc-900 text-5xl font-mono" style="z-index: 101; line-height: 1; -webkit-user-select: none; user-select: none; opacity: 0.7;">&times;</button>
            
            <!-- El 'pre' tag ahora est谩 centrado dentro del contenedor del celular (COLOR CAMBIADO) -->
            <div class="flex-1 grid place-items-center overflow-hidden">
                <pre id="heart-display" style="font-family: 'Courier New', Courier, monospace; font-size: 10px; line-height: 1.0; text-align: center; color: #a65eed; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;"></pre>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // === CDIGO DE FRESA EXISTENTE ===
            const strawberryButton = document.getElementById('strawberryButton');
            const rainContainer = document.getElementById('rain-container');
            const heartContainer = document.getElementById('heart-container');

            let consecutiveClicks = 0;
            let clickTimer = null;

            const animationStyleSheetEl = document.createElement('style');
            animationStyleSheetEl.type = 'text/css';
            document.head.appendChild(animationStyleSheetEl);
            const styleSheet = animationStyleSheetEl.sheet;

            strawberryButton.addEventListener('click', () => {
                consecutiveClicks++;
                if (clickTimer) clearTimeout(clickTimer);

                if (consecutiveClicks === 10) {
                    // rainContainer.innerHTML = ''; // No limpiar las fresas
                    heartContainer.innerHTML = '';
                    createStrawberryHeart();
                    consecutiveClicks = 0;
                } else {
                    for (let i = 0; i < 15; i++) {
                        createFallingStrawberry();
                    }
                }

                clickTimer = setTimeout(() => {
                    consecutiveClicks = 0;
                }, 2000);
            });

            function createFallingStrawberry() {
                const strawberry = document.createElement('div');
                strawberry.classList.add('strawberry');
                strawberry.innerText = '';

                strawberry.style.left = `${Math.random() * 100}%`;
                const duration = Math.random() * 2 + 1;
                strawberry.style.animationDuration = `${duration}s`;
                strawberry.style.animationDelay = `${Math.random() * 1}s`;
                strawberry.style.fontSize = `${Math.random() * 1.5 + 1}rem`;
                strawberry.style.opacity = `1`;

                rainContainer.appendChild(strawberry);

                setTimeout(() => {
                    strawberry.remove();
                }, (duration + 1) * 1000);
            }

            function createStrawberryHeart() {
                const heartPattern = [
                    "    ******         ******",
                    "    ******         ******",
                    "  **********     **********",
                    "  **********     **********",
                    " ************* *************",
                    "*****************************",
                    "*****************************",
                    "*****************************",
                    "*****************************",
                    " ***************************",
                    " ***************************",
                    "   ***********************",
                    "   ***********************",
                    "     *******************",
                    "     *******************",
                    "       ***************",
                    "       ***************",
                    "         ***********",
                    "         ***********",
                    "           *******",
                    "           *******",
                    "             ***",
                    "             ***",
                    "              *"
                ];

                const scale = 15; // Ajustar la escala general del coraz贸n (tama帽o de la celda)
                const strawberrySize = 1.5; // Tama帽o del emoji en rem
                const delayBetweenFresas = 5; // ms para dibujar el coraz贸n m谩s r谩pido

                const maxWidth = heartPattern.reduce((max, r) => Math.max(max, r.length), 0);
                const totalStars = heartPattern.join('').replace(/ /g, '').length;
                let starsPlaced = 0;

                heartPattern.forEach((row, rowIndex) => {
                    for (let i = 0; i < row.length; i++) {
                        if (row[i] === '*') {
                            setTimeout(() => {
                                const strawberry = document.createElement('div');
                                strawberry.classList.add('strawberry-heart-piece');
                                strawberry.innerText = '';

                                const xOffset = (i - (maxWidth - 1) / 2) * scale;
                                const yOffset = (rowIndex - (heartPattern.length - 1) / 2) * scale;

                                strawberry.style.left = `calc(50% + ${xOffset}px)`;
                                strawberry.style.top = `calc(50% + ${yOffset}px)`;
                                strawberry.style.fontSize = `${strawberrySize}rem`;
                                heartContainer.appendChild(strawberry);

                                starsPlaced++;

                                if (starsPlaced === totalStars) {
                                    setTimeout(explodeHeart, 500); // Esperar un momento antes de explotar
                                }
                            }, starsPlaced * delayBetweenFresas); // Usar el contador para el retraso
                        }
                    }
                });
            }

            function explodeHeart() {
                const strawberries = heartContainer.querySelectorAll('.strawberry-heart-piece');
                strawberries.forEach((strawberry, index) => {
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * 200 + 100;
                    const translateX = distance * Math.cos(angle);
                    const translateY = distance * Math.sin(angle);
                    const rotation = Math.random() * 720 - 360;

                    const keyframesName = `explode-strawberry-${index}`;

                    styleSheet.insertRule(`
                        @keyframes ${keyframesName} {
                            from {
                                transform: translate(-50%, -50%) scale(1);
                                opacity: 1;
                                filter: blur(0);
                            }
                            to {
                                transform: translate(calc(-50% + ${translateX}px), calc(-50% + ${translateY}px)) rotate(${rotation}deg) scale(1);
                                opacity: 0;
                                filter: blur(2px);
                            }
                        }
                    `, styleSheet.cssRules.length);

                    strawberry.style.animation = `${keyframesName} 1.5s ease-out forwards`;

                    setTimeout(() => {
                        strawberry.remove();
                        // Limpiar la regla de keyframes para evitar que se acumulen
                        for (let i = 0; i < styleSheet.cssRules.length; i++) {
                            if (styleSheet.cssRules[i] && styleSheet.cssRules[i].name === keyframesName) {
                                styleSheet.deleteRule(i);
                                break;
                            }
                        }
                    }, 1500);
                });
            }

            // === CDIGO NUEVO DEL CORAZN 3D ===

            // --- Referencias a elementos del Modal ---
            const heartButton = document.getElementById('heartButton');
            const heartModal = document.getElementById('heartModal');
            const closeHeartModal = document.getElementById('closeHeartModal');
            const heartDisplayPre = document.getElementById('heart-display');
            const heartModalContainer = document.getElementById('heartModalContainer'); // AADIDO

            // Comprobar que todos los elementos del modal existen
            if (heartButton && heartModal && closeHeartModal && heartDisplayPre && heartModalContainer) { // ACTUALIZADO

                // --- Constantes y variables globales del Coraz贸n 3D ---
                const PI = Math.PI;
                const LUMINANCE = ".,-~:;=!*#$@"; // 12 caracteres

                let SCREEN_WIDTH, SCREEN_HEIGHT;
                let output, zbuffer;

                let heart_angleA = 0; // ngulo de rotaci贸n X
                let heart_angleB = 0; // ngulo de rotaci贸n Y

                let heart_animationId = null; // Para iniciar/detener el loop

                // --- Variables para control de mouse ---
                let heart_isDragging = false;
                let heart_lastMouseX = 0;
                let heart_lastMouseY = 0;

                // --- Funciones de Math ---
                const cos = Math.cos;
                const sin = Math.sin;
                const sqrt = Math.sqrt;

                /**
                 * Inicializa (o reinicializa) los buffers con el tama帽o del modal.
                 */
                function setupBuffers() {
                    const charWidth = 6; // Ancho de caracter (aprox de Courier 10px)
                    const charHeight = 10; // Alto de caracter (del font-size 10px)

                    // Usar las dimensiones del modal, no de la ventana
                    SCREEN_WIDTH = Math.floor(heartModalContainer.clientWidth / charWidth); // CAMBIADO
                    SCREEN_HEIGHT = Math.floor(heartModalContainer.clientHeight / charHeight); // CAMBIADO
                    
                    // Evitar errores si el modal est谩 oculto y no tiene dimensiones
                    if (SCREEN_WIDTH <= 0 || SCREEN_HEIGHT <= 0) {
                        SCREEN_WIDTH = 80; // Default
                        SCREEN_HEIGHT = 40; // Default
                    }

                    output = Array(SCREEN_HEIGHT).fill(0).map(() => Array(SCREEN_WIDTH).fill(' '));
                    zbuffer = Array(SCREEN_HEIGHT).fill(0).map(() => Array(SCREEN_WIDTH).fill(-Infinity));
                }

                /**
                 * Renderiza un frame del coraz贸n 3D.
                 */
                function renderFrame(A, B) {
                    const cosA = cos(A),
                        sinA = sin(A);
                    const cosB = cos(B),
                        sinB = sin(B);

                    // Reiniciar buffers en cada frame
                    for (let i = 0; i < SCREEN_HEIGHT; i++) {
                        for (let j = 0; j < SCREEN_WIDTH; j++) {
                            output[i][j] = ' ';
                            zbuffer[i][j] = -Infinity;
                        }
                    }

                    // Muestreo de la superficie del coraz贸n
                    for (let u = 0; u < 2 * PI; u += 0.04) { // Incremento 0.04
                        for (let v = 0; v < PI; v += 0.04) { // Incremento 0.04

                            // Ecuaciones param茅tricas del coraz贸n
                            let x = sin(v) * (15 * sin(u) - 4 * sin(3 * u));
                            let y = 8 * cos(v);
                            let z = sin(v) * (15 * cos(u) - 5 * cos(2 * u) - 2 * cos(3 * u) - cos(4 * u));

                            // Rotar alrededor del eje Y (con B)
                            let x1 = x * cosB + z * sinB;
                            let y1 = y;
                            let z1 = -x * sinB + z * cosB;

                            // Rotar alrededor del eje X (con A)
                            let x_rot = x1;
                            let y_rot = y1 * cosA - z1 * sinA;
                            let z_rot = y1 * sinA + z1 * cosA;

                            // Proyecci贸n
                            let z_offset = 70;
                            let ooz = 1 / (z_rot + z_offset); // ooz = "one over z"

                            // Ajustamos la escala de proyecci贸n a las dimensiones de la pantalla
                            let xp = Math.floor(SCREEN_WIDTH / 2 + x_rot * ooz * SCREEN_WIDTH * 0.5);
                            let yp = Math.floor(SCREEN_HEIGHT / 2 - y_rot * ooz * SCREEN_HEIGHT * 0.5);

                            // Calcular normales
                            let nx = sin(v) * (15 * cos(u) - 4 * cos(3 * u));
                            let ny = 8 * -sin(v) * sin(v);
                            let nz = cos(v) * (15 * sin(u) - 5 * sin(2 * u) - 2 * sin(3 * u) - sin(4 * u));

                            // Rotar normales (eje Y)
                            let nx1 = nx * cosB + nz * sinB;
                            let ny1 = ny;
                            let nz1 = -nx * sinB + nz * cosB;

                            // Rotar normales (eje X)
                            let nx_rot = nx1;
                            let ny_rot = ny1 * cosA - nz1 * sinA;
                            let nz_rot = ny1 * sinA + nz1 * cosA;

                            // Normalizar el vector normal
                            let length = sqrt(nx_rot * nx_rot + ny_rot * ny_rot + nz_rot * nz_rot);
                            nx_rot /= length;
                            ny_rot /= length;
                            nz_rot /= length;

                            // Direcci贸n de la luz
                            let lx = 0;
                            let ly = 0;
                            let lz = -1; // Luz simple desde "detr谩s" de la pantalla (negativo z)

                            // Producto punto para la luminancia
                            let L = nx_rot * lx + ny_rot * ly + nz_rot * lz;

                            // Mapear L (que va de -1 a 1) a un 铆ndice de luminancia (0 a 11)
                            let luminance_index = Math.floor((L + 1) * 5.5);

                            // Comprobaci贸n del Z-buffer
                            if (xp >= 0 && xp < SCREEN_WIDTH && yp >= 0 && yp < SCREEN_HEIGHT) {
                                if (ooz > zbuffer[yp][xp]) {
                                    zbuffer[yp][xp] = ooz;

                                    // Asegurarse que el 铆ndice est谩 dentro de los l铆mites
                                    luminance_index = luminance_index < 0 ? 0 : (luminance_index > 11 ? 11 : luminance_index);

                                    output[yp][xp] = LUMINANCE[luminance_index];
                                }
                            }
                        }
                    }
                }

                /**
                 * El bucle principal de animaci贸n del coraz贸n
                 */
                function heartLoop() {
                    // Solo girar autom谩ticamente si no estamos arrastrando
                    if (!heart_isDragging) {
                        heart_angleA += 0.04; // M谩s lento
                        heart_angleB += 0.015; // M谩s lento
                    }

                    // Renderizar el frame en los buffers
                    renderFrame(heart_angleA, heart_angleB);

                    // Construir la cadena de texto y mostrarla
                    let outputString = "";
                    for (let i = 0; i < SCREEN_HEIGHT; i++) {
                        outputString += output[i].join('');
                        outputString += '\n';
                    }
                    heartDisplayPre.textContent = outputString;

                    // Pedir al navegador que llame a `heartLoop` de nuevo
                    heart_animationId = requestAnimationFrame(heartLoop);
                }

                // --- Event Listeners para el Modal ---

                // Abrir el modal
                heartButton.addEventListener('click', () => {
                    heartModal.style.display = 'flex'; // CAMBIADO
                    document.body.style.overflow = 'hidden'; // Evitar scroll de la p谩gina principal
                    setupBuffers(); // Configurar tama帽o inicial
                    if (heart_animationId) cancelAnimationFrame(heart_animationId); // Por si acaso
                    heartLoop(); // Iniciar animaci贸n
                });

                // Cerrar el modal
                closeHeartModal.addEventListener('click', () => {
                    heartModal.style.display = 'none';
                    document.body.style.overflow = ''; // Restaurar scroll
                    if (heart_animationId) {
                        cancelAnimationFrame(heart_animationId); // Detener animaci贸n
                        heart_animationId = null;
                    }
                });

                // --- Listeners de Mouse (atados al modal para evitar conflictos) ---
                heartModalContainer.addEventListener('mousedown', (e) => { // CAMBIADO
                    heart_isDragging = true;
                    heart_lastMouseX = e.clientX;
                    heart_lastMouseY = e.clientY;
                    heartModalContainer.classList.add('grabbing'); // Cambiar cursor al arrastrar // CAMBIADO
                    e.preventDefault(); // Prevenir selecci贸n de texto
                });

                heartModalContainer.addEventListener('mousemove', (e) => { // CAMBIADO
                    if (!heart_isDragging) return;

                    const deltaX = e.clientX - heart_lastMouseX;
                    const deltaY = e.clientY - heart_lastMouseY;

                    // Ajustar los 谩ngulos basados en el movimiento del mouse
                    heart_angleB += deltaX * 0.005;
                    heart_angleA -= deltaY * 0.005; // Negativo para que se sienta natural

                    heart_lastMouseX = e.clientX;
                    heart_lastMouseY = e.clientY;
                });

                heartModalContainer.addEventListener('mouseup', () => { // CAMBIADO
                    heart_isDragging = false;
                    heartModalContainer.classList.remove('grabbing'); // Volver al cursor normal // CAMBIADO
                });

                heartModalContainer.addEventListener('mouseleave', (e) => { // CAMBIADO
                    // Detener el arrastre si el mouse sale del modal
                    heart_isDragging = false;
                    heartModalContainer.classList.remove('grabbing'); // CAMBIADO
                });

                /*
                // Este listener parece redundante con el de 'heartModalContainer'
                heartModal.addEventListener('mouseleave', (e) => {
                    // Detener el arrastre si el mouse sale del modal
                    heart_isDragging = false;
                    heartModal.classList.remove('grabbing');
                });
                */


                // Listener para redimensionar la ventana
                window.addEventListener('resize', () => {
                    if (heartModal.style.display === 'flex') { // CAMBIADO
                        // Solo recalcular si el modal est谩 visible
                        setupBuffers();
                    }
                });
            } else {
                console.error("No se pudieron encontrar los elementos del modal del coraz贸n 3D.");
            }

        });
    </script>

</body>
</html>

